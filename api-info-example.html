<!doctype html> <html lang="zh-CN"> <head> <meta charset="utf-8"> <title>接口文档</title> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"> <link rel="stylesheet" href="//cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/validationEngine.jquery.min.css"> <style type="text/css"> html { position: relative; min-height: 100%; } body { font-size: 16px; } header { top: 0; position: sticky; height: 50px; width: 100%; z-index: 999; transition: all .3s ease-in-out; border-bottom: 1px solid #f7f8f8; display: flex; } header.scrolled { box-shadow: 0 0 10px -2px #333; background: rgba(255,255,255,0.94); } .anchor { display: block; position: relative; top: -51px; visibility: hidden; width: 0; height: 0; } input, select { min-width: 180px; width: 100%; min-height: 28px; } textarea { min-height: 120px; height: 100% !important; min-width: 180px; width: 100% !important; } input[type=button] { width: 180px; height: 32px; border: none; font-size: 16px; color: #fff; background-color: #56baed; box-shadow: 0 10px 30px 0 rgba(95,186,233,0.4); transition: all 0.3s ease-in-out; } input[type=button]:hover { color: #fff; background-color: #39ace7; } input[type=button]:active { transform: scale(0.95); } pre { font-size: 14px; overflow: auto; margin: 0 0 14px; padding: 7px 14px; } pre .line-number { color: #2B91AF; display: block; float: left; margin: 0 14px 0 -14px; border-right: 1px solid; text-align: right; padding: 0 7px 0 14px; } pre .comment { color: #998; font-style: italic; } table thead tr th { white-space: nowrap; } .header { display: flex; width: 100%; } .header-content { display: flex; align-items: center; flex-grow: 1; font-size: 26px; color: #6495ed; overflow: hidden; white-space: nowrap; } .header-select, .header-text { display: flex; align-items: center; flex-grow: 0; } .header-text { white-space: nowrap; padding: 0 5px 0 20px; } .project-choose { min-width: 200px; } .footer { position: absolute; height: 133px; width: 100%; background: #f5f5f5; padding: 10px; } .footer > p { margin: 5px 0; text-align: center; } .panel { overflow: auto; } .input-group { position: unset; } .module, .module-last {} .module-name { border-bottom: 5px solid #eee; margin-bottom: -5px; } .module-api { border-bottom: 1px solid #eee; padding-bottom: 5px; } .module-last > .module-api:last-child { border-bottom: none; } .module-api-index {} .module-api-info {} .module-api-info-basic {} .module-api-info-desc {} .module-api-info-param {} .module-api-info-return {} .bottom-table { margin-bottom: 10px; } .text-left { vertical-align: middle !important; } .response-example { color: #337ab7; text-decoration: none; background-color: transparent; cursor: pointer; } .response-example:focus, .response-example:hover { color: #23527c; text-decoration: underline; } .modal-dialog { width: 75%; } .formError { white-space: nowrap; } .example { min-width: 200px; } .curl, .response { display: none; } .bold { font-weight: bold !important; } .wrap { white-space: pre-wrap; } .green { color: green !important; } .red { color: red !important; } .copy-status { right: 0; position: absolute; color: rgba(255, 0, 0, .8); margin: 7px 14px 0 0; padding-right: 65px; } .copy { right: 0; position: absolute; cursor: pointer; color: rgba(140, 140, 140, .8); margin: 7px 14px 0 0; padding-right: 14px; transition: color .1s; } .copy:hover { color: rgb(100, 100, 100); font-weight: bold; } .copy-impl { opacity: 0; width: 0 !important; height: 0 !important; } .bs-docs-sidebar { width: inherit; position: fixed; margin: 15px 0; } .bs-docs-sidebar > .nav { overflow-y: auto; max-height: calc(100vh - 51px - 15px - 15px); } .bs-docs-sidebar .nav > li > a { display: block; padding: 4px 0 4px 20px; font-size: 14px; font-weight: 500; color: #999; } .bs-docs-sidebar .nav > li > a:hover, .bs-docs-sidebar .nav > li > a:focus { padding-left: 19px; color: #A1283B; text-decoration: none; background-color: transparent; border-left: 1px solid #A1283B; } .bs-docs-sidebar .nav > .active > a, .bs-docs-sidebar .nav > .active:hover > a, .bs-docs-sidebar .nav > .active:focus > a { padding-left: 18px; font-weight: bold; color: #A1283B; background-color: transparent; border-left: 2px solid #A1283B; } .bs-docs-sidebar .nav .nav { display: none; padding-bottom: 10px; } .bs-docs-sidebar .nav .nav > li > a { padding-top: 1px; padding-bottom: 1px; padding-left: 30px; font-size: 12px; font-weight: normal; } .bs-docs-sidebar .nav .nav > li > a:hover, .bs-docs-sidebar .nav .nav > li > a:focus { padding-left: 29px; } .bs-docs-sidebar .nav .nav > .active > a, .bs-docs-sidebar .nav .nav > .active:hover > a, .bs-docs-sidebar .nav .nav > .active:focus > a { padding-left: 28px; font-weight: 500; } .bs-docs-sidebar .nav .nav .nav { padding-bottom: 10px; } .bs-docs-sidebar .nav .nav .nav > li > a { padding-top: 1px; padding-bottom: 1px; padding-left: 40px; font-size: 12px; font-weight: normal; } .bs-docs-sidebar .nav .nav .nav > li > a:hover, .bs-docs-sidebar .nav .nav .nav > li > a:focus { padding-left: 39px; } .bs-docs-sidebar .nav > .active > ul { display: block; } .bs-docs-sidebar .nav .nav .nav > .active > a, .bs-docs-sidebar .nav .nav .nav > .active:hover > a, .bs-docs-sidebar .nav .nav .nav > .active:focus > a { padding-left: 38px; font-weight: 500; } @media print { pre .line-number, .print-nil { display: none; } pre, .text-left, .panel { overflow: unset; } pre, .text-left { white-space: pre-wrap; } } @media (max-width: 992px), print { .col-md-9 { width: 100%; } .col-md-3 { display: none; } } @media (max-width: 992px) { .modal-dialog { width: 95%; } } @media (min-width: 993px) and (max-width: 1200px) { .bs-docs-sidebar { padding-left: 10px; width: calc(25% - 10px - 10px); } } @media (min-width: 1201px) { .bs-docs-sidebar { padding-left: 20px; width: calc(25% - 20px - 10px); } } </style> </head> <body> <header class="print-nil"> <div class="header container-fluid"> <div class="header-content"></div> </div> </header> <script id="choose-project" type="text/x-dot-template"> <div class="header-text">选择项目:</div> <div class="header-select"> <select class="project-choose form-control" name="p"> <option value="">当前</option> {{ var cp = it.project; }} {{~ it.projects :p}} {{ var s = (cp.toLowerCase() === p[0].toLowerCase() || cp === p[1]) ? ' selected' : ''; }} <option value="{{= p[0]}}" data-url="{{= p[2]}}"{{= s}}>{{= p[1]}}</option> {{~}} </select> </div> </script> <main class="container-fluid"> <div class="row"> <div id="url-info" class="col-md-9"></div> <script id="url-render" type="text/x-dot-template"> {{~ it.moduleList :module:index}} <div class="{{= index + 1 === it.moduleList.length ? 'module-last' : 'module'}}"> <span id="{{= module.name}}" class="anchor"></span> <h2 class="module-name"> <span>{{= index + 1}}</span> {{= module.info || ''}} </h2> {{~ module.urlList :url:urlIndex}} <div class="module-api"> <span id="{{= module.name}}-{{= url.id}}" class="anchor"></span> <h3 class="module-api-index"> <span>{{= index + 1}}.{{= urlIndex + 1}}</span> {{= url.title || ''}} </h3> <div class="module-api-info"> <p class="module-api-info-basic">接口地址 <code>{{= url.method || ''}} {{= url.url || ''}}</code></p> {{ var moduleDesc = ''; if (url.develop && url.develop !== '') { moduleDesc += '开发: ' + url.develop; } if (url.desc && url.desc !== '') { if (moduleDesc !== '') { moduleDesc += '<br>'; } moduleDesc += '说明: ' + url.desc; } var printNil = ''; if (url.exampleUrl && url.exampleUrl != '') { var example = '<a target="_blank" href="' + url.exampleUrl + '">响应结果示例地址</a>'; if (moduleDesc !== '') { moduleDesc += '<span class="print-nil"><br><br>' + example + '</span>'; } else { printNil = ' print-nil'; moduleDesc += example; } } }} <pre class="module-api-info-desc{{= printNil}}">{{= moduleDesc}}</pre> <div class="module-api-info-return"> <p>响应示例及说明如下</p> <div class="copy-status print-nil"></div> <div class="copy print-nil">复制</div> <pre class="src src-json" data-flag="module-api-info-return-src">{{= url.commentJson || ''}}</pre> {{? url.returnList && url.returnList.length > 0}} <div class="bottom-table panel panel-default" data-flag="module-api-info-return-comment"> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th class="text-left">名称</th> <th class="text-left">类型</th> <th class="text-left">说明</th> </tr> </thead> <tbody> {{~ url.returnList :rtn}} <tr> <td class="text-left">{{= rtn.name || ''}}</td> <td class="text-left">{{= rtn.type || ''}}</td> <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td> </tr> {{~}} </tbody> </table> </div> {{?}} {{ var hasSelfResponse = false; var responseList; if (url.responseList && url.responseList.length > 0) { hasSelfResponse = true; responseList = url.responseList; } else if (it.responseList && it.responseList.length > 0) { responseList = it.responseList; } else { responseList = []; } var hasAction = false; for (var i = 0; i < responseList.length; i++) { var comment = responseList[i].comment; if (comment !== undefined && comment !== null && comment !== '') { hasAction = true; } } }} {{? responseList.length > 0}} <div class="bottom-table panel panel-default"> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th class="text-left">响应码</th> <th class="text-left">说明</th> {{? hasAction}}<th class="text-left print-nil">操作</th>{{?}} </tr> </thead> <tbody> {{~ responseList :response}} <tr> <td class="text-left">{{= response.code || ''}}</td> <td class="text-left">{{= response.msg || ''}}</td> {{ var comment = response.comment; var targetId = hasSelfResponse ? (module.name + '-' + url.id + '-' + response.code) : ('global-' + response.code); }} {{? comment !== undefined && comment !== null && comment !== ''}} <td class="text-left print-nil"> <span class="response-example" title="点击查看响应 {{= response.code + ': ' + response.msg}} 时的示例" data-toggle="modal" data-target="#{{= targetId}}">查看示例</span> </td> {{?? hasAction}} <td class="text-left print-nil"></td> {{?}} </tr> {{~}} </tbody> </table> </div> {{? hasSelfResponse}} {{~ responseList :response}} {{ var comment = response.comment; }} {{? comment !== undefined && comment !== null && comment !== ''}} <div id="{{= module.name}}-{{= url.id}}-{{= response.code}}" class="modal fade" tabindex="-1" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal"> &times; </button> <h4 class="modal-title"> 模块「{{= module.info || ''}}」接口「{{= url.title || ''}}」响应「{{= response.code + ': ' + response.msg}}」的示例 </h4> </div> <div class="modal-body"> <div class="copy-status print-nil"></div> <div class="copy print-nil">复制</div> <pre class="src src-json">{{= response.comment || ''}}</pre> {{? response.returnList && response.returnList.length > 0}} <div class="bottom-table panel panel-default"> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th class="text-left">名称</th> <th class="text-left">类型</th> <th class="text-left">说明</th> </tr> </thead> <tbody> {{~ response.returnList :rtn}} <tr> <td class="text-left">{{= rtn.name || ''}}</td> <td class="text-left">{{= rtn.type || ''}}</td> <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td> </tr> {{~}} </tbody> </table> </div> {{?}} </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> </div> </div> </div> {{?}} {{~}} {{?}} {{?}} </div> {{ var globalParamList = it.tokenList || []; var urlParamList = url.paramList || []; var paramList = String(url.useGlobalParam) === '1' ? globalParamList.concat(urlParamList) : urlParamList; var hasDesc = false, hasFile = false, hasHeader = false; for (var i = 0; i < paramList.length; i++) { var paramDesc = paramList[i].desc; if (paramDesc !== undefined && paramDesc !== null && paramDesc !== '') { hasDesc = true; } if (String(paramList[i].hasFile) === '1') { hasFile = true; } if (String(paramList[i].paramType) === '1') { hasHeader = true; } } var textNum = 0; }} <form class="module-api-info-param"{{? url.method}} method="{{= url.method}}"{{?}} {{? url.url}} action="{{= url.url}}"{{?}} data-test-url="{{= url.id}}" {{? hasFile}} enctype="multipart/form-data"{{?}}> {{? paramList && paramList.length > 0}} <div class="bottom-table panel panel-default"> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th class="text-left">参数名称</th> <th class="text-left example">示例</th> <th class="text-left">必须</th> <th class="text-left">数据类型</th> {{? hasHeader}}<th class="text-left">参数类型</th>{{?}} {{? hasDesc}}<th class="text-left">说明</th>{{?}} </tr> </thead> <tbody> {{~ paramList :param:paramIndex}} {{ var hasTextarea = String(param.hasTextarea) === '1'; var arr = []; var hasMust; if (String(param.hasMust) === '1') { hasMust = true; arr.push('required'); } else { hasMust = false; } var dataType = (param.dataType || '').toLowerCase(); if (dataType === 'int' || dataType === 'long') { arr.push('custom[integer]'); } else if (dataType === 'float' || dataType === 'double') { arr.push('custom[number]'); } else if (dataType === 'email') { arr.push('custom[email]'); } else if (dataType === 'url') { arr.push('custom[url]'); } else if (dataType === 'ipv4') { arr.push('custom[ipv4]'); } var arrJoin = arr.filter(function(e){ return e !== undefined && e !== null && e !== ''; }).join(','); var validateClass = (arrJoin !== undefined && arrJoin !== null && arrJoin !== '') ? (' validate[' + arrJoin + ']') : ''; var tokenClass = String(param.hasToken) === '1' ? ' has-token' : ''; var header = String(param.paramType) === '1' ? ' header="1"' : ''; var example = localStorage.getItem(param.name) || param.example || ''; var enumRegexExec = /^enum\((.*?)\)$/.exec(param.dataType); var enumInfo = (Array.isArray(enumRegexExec) && enumRegexExec.length > 1) ? it.enumInfo[enumRegexExec[1]] : ''; }} <tr{{? hasMust}} class="bold"{{?}}{{? param.style && param.style !== ''}} style="{{= param.style}}"{{?}}> <td class="text-left">{{= param.name || ''}}</td> <td class="text-left" style="height: inherit;"> {{? dataType === 'file'}} <div class="input-group"> <label class="input-group-btn"> <span class="btn btn-default{{? hasMust}} bold{{?}}"> 选择文件 <input class="form-file hidden" type="file" name="{{= param.name || ''}}"> </span> </label> <input type="text" class="form-control{{? hasMust}} bold{{?}}{{= validateClass}}" readonly="readonly"> </div> {{?? hasTextarea}} <textarea class="form-control{{= validateClass}}{{= tokenClass}}" name="{{= param.name || ''}}"{{= header}}>{{= example}}</textarea> {{?? enumInfo !== undefined && enumInfo !== null && enumInfo !== ''}} <select class="form-control{{= validateClass}}{{= tokenClass}}" name="{{= param.name || ''}}"{{= header}}> <option></option> {{? Array.isArray(enumInfo) }} {{~ enumInfo :e}}<option{{? example === e}} selected="selected"{{?}}>{{= e}}</option>{{~}} {{??}} {{ var k; for(k in enumInfo) { }} <option value="{{= k}}"{{? example === k || example === enumInfo[k]}} selected="selected"{{?}}>{{= enumInfo[k]}}</option> {{ } }} {{?}} </select> {{?? (param.showDataType || '').toLowerCase() === 'date' || dataType === 'date'}} {{ var hasFormat = param.datePattern !== undefined && param.datePattern !== null && param.datePattern !== '';}} <div class="input-group date form-datetime"> <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span> <input type="text" name="{{= param.name || ''}}"{{= header}} class="form-control{{? hasMust}} bold{{?}}{{= validateClass}}{{= tokenClass}}" {{? hasFormat}} data-date-format="{{= param.datePattern.replace(/yy/g, 'YY')}}"{{?}}/> </div> {{??}} {{ textNum++; }} <input class="form-control{{= validateClass}}{{= tokenClass}}" type="{{= (param.name || '').toLowerCase() === 'password' ? 'password' : 'text'}}" name="{{= param.name || ''}}"{{= header}} value="{{= example}}"/> {{?}} </td> <td class="text-left">{{= hasMust ? 'Yes' : 'No'}}</td> <td class="text-left">{{= param.showDataType && param.showDataType !== '' ? param.showDataType : (param.dataType && param.dataType !== '' ? param.dataType : '') }}</td> {{? hasHeader}}<td class="text-left">{{= String(param.paramType) === '1' ? 'Header' : 'Query'}}</td>{{?}} {{? hasDesc}}<td class="text-left wrap">{{= param.desc || ''}}</td>{{?}} </tr> {{~}} </tbody> </table> </div> {{?}} <p> {{? textNum === 1 }}<input type="text" class="hidden" />{{?}} <input class="form-submit btn" type="button" value="请求此接口"{{? String(url.requestBody) === '1'}} requestBody="1"{{?}}/> </p> <div class="curl"> <div class="copy-status print-nil"></div> <div class="copy print-nil">复制</div> <pre class="src src-json"></pre> </div> <div class="response"> <div class="copy-status print-nil"></div> <div class="copy print-nil">复制</div> <pre class="src src-json"></pre> </div> </form> </div> </div> {{~}} </div> {{~}} {{~ it.responseList :response}} {{ var comment = response.comment; }} {{? comment !== undefined && comment !== null && comment !== ''}} <div id="global-{{= response.code}}" class="modal fade" tabindex="-1" aria-hidden="true" data-backdrop="static" data-keyboard="false"> <div class="modal-dialog modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal"> &times; </button> <h4 class="modal-title"> 全局响应「{{= response.code + ': ' + response.msg}}」的示例 </h4> </div> <div class="modal-body"> <div class="copy-status print-nil"></div> <div class="copy print-nil">复制</div> <pre class="src src-json">{{= response.comment || ''}}</pre> {{? response.returnList && response.returnList.length > 0}} <div class="bottom-table panel panel-default"> <table class="table table-striped table-bordered table-hover table-condensed"> <thead> <tr> <th class="text-left">名称</th> <th class="text-left">类型</th> <th class="text-left">说明</th> </tr> </thead> <tbody> {{~ response.returnList :rtn}} <tr> <td class="text-left">{{= rtn.name || ''}}</td> <td class="text-left">{{= rtn.type || ''}}</td> <td class="text-left wrap">{{= (rtn.desc || '').replace(/(!!!RECURSIVE OBJECT!!!)/, '<span class="bold red">!!!递归实体!!!</span>')}}</td> </tr> {{~}} </tbody> </table> </div> {{?}} </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button> </div> </div> </div> {{?}} {{~}} </script> <div class="col-md-3"> <div class="bs-docs-sidebar"> <ul id="url-nav-info" class="nav"></ul> <script id="url-nav-render" type="text/x-dot-template"> {{~ it.moduleList :module:index}} <li> <a href="#{{= module.name}}">{{= index + 1}} {{= module.info || ''}}</a> <ul class="nav"> {{~ module.urlList :url:urlIndex}} <li> <a href="#{{= module.name}}-{{= url.id}}">{{= index + 1}}.{{= urlIndex + 1}} {{= url.title || ''}}</a> </li> {{~}} </ul> </li> {{~}} </script> </div> </div> </div> </main> <footer></footer> <script id="copyright" type="text/x-dot-template"> <div class="footer"> <p class="version">版本: {{= it.version || ''}}</p> <p class="statistics">共 {{= it.groupCount || ''}} 个模块, {{= it.apiCount || ''}} 个接口</p> <p class="team">{{= it.team || ''}}</p> <p class="copyright">&copy; {{= new Date().getFullYear()}} {{= it.copyright || ''}}</p> </div> </script> <!--[if lt IE 9]> <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script> <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script> <![endif]--> <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> <script src="//cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script> <script src="//cdn.bootcss.com/dot/1.1.2/doT.min.js"></script> <script src="//cdn.bootcss.com/moment.js/2.24.0/moment.min.js"></script><script src="//cdn.bootcss.com/moment.js/2.24.0/locale/zh-cn.js"></script> <script src="//cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script> <script src="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/languages/jquery.validationEngine-zh_CN.min.js"></script> <script src="//cdn.bootcss.com/jQuery-Validation-Engine/2.6.4/jquery.validationEngine.min.js"></script> <script type="text/javascript"> function isBlank(str) { return str === undefined || str === null || str === 'undefined' || str === 'null' || str === ''; } function isNotBlank(str) { return !isBlank(str); } function addLine(html) { if (isBlank(html)) { return ''; } var lineNum = html.split(/\n/).length; var lineHtml = '<span class="line-number">'; var i; for (i = 0; i < lineNum; i++) { lineHtml += (i + 1) + '\n'; } lineHtml = lineHtml.trim(); lineHtml += '</span>'; return lineHtml + html; } function escapeHtml(html) { return isBlank(html) ? null : html.replace(/</g, '&lt;').replace(/>/g, '&gt;'); } function getProjectDomain() { var projectDomain = $('.project-choose').find('option:selected').data('url'); return isBlank(projectDomain) ? (location.protocol + '//' + location.host) : projectDomain; } function timeLog(start) { var end = new Date().getTime(); return '请求时长: ' + (end - start) + 'ms\n' + formatDate(start) + ' -> ' + formatDate(end) + '\n\n'; } function objectifyForm(form) { var headers = {}; var params = {}; $.each(form.serializeArray(), function(i, field) { var name = field.name; var value = field.value; var header = form.find('[name="' + name + '"]').attr('header'); if (String(header) === '1') { headers[name] = value; } else { params[name] = value; } }); return [params, headers, form.find('input[type="file"]')]; } function formatDate(date) { var d = new Date(date); var y = d.getFullYear().toString(); var m = (d.getMonth() + 1).toString(); if (m.length === 1) { m = '0' + m; } var dy = d.getDate().toString(); if (dy.length === 1) { dy = '0' + dy; } var h = d.getHours().toString(); if (h.length === 1) { h = '0' + h; } var mt = d.getMinutes().toString(); if (mt.length === 1) { mt = '0' + mt; } var s = d.getSeconds().toString(); if (s.length === 1) { s = '0' + s; } var S = d.getMilliseconds().toString(); if (S.length === 1) { S = '00' + S; } else if (S.length === 2) { S = '0' + S; } return y + '-' + m + '-' + dy + ' ' + h + ':' + mt + ':' + s + ' ' + S; } var chooseProjectTemplate = doT.template($('#choose-project').html()); var copyrightTemplate = doT.template($('#copyright').html()); var urlRenderTemplate = doT.template($('#url-render').html()); var navRenderTemplate = doT.template($('#url-nav-render').html()); $.get('/cn/api-project.json').done(function(data) { if (isNotBlank(data)) { var projectInfo = ((typeof data === 'string') ? JSON.parse(data) : data); if (isNotBlank(projectInfo)) { var project = location.search; var param = 'p=', append = '&'; if (project.includes(param)) { project = project.substring(project.indexOf(param) + param.length); if (project.includes(append)) { project = project.substring(0, project.indexOf(append)); } } $(".header").append(chooseProjectTemplate({ "project" : project, "projects" : projectInfo })); } } loadData(); }).fail(function() { loadData(); }); function loadData() { var $title = $('title'); var $headerContent = $('.header-content'); var $footer = $('footer'); var $urlInfo = $('#url-info'); var $urlNavInfo = $('#url-nav-info'); $title.html(''); $headerContent.html(''); $footer.html(''); $urlInfo.html(''); $urlNavInfo.html(''); var method = 'GET'; var apiInfo = '/cn/api-info.json'; var projectDomain = getProjectDomain(); var requestUrl = projectDomain.endsWith('.json') ? projectDomain : ((projectDomain.endsWith('/') ? projectDomain.substring(0, projectDomain.length - 1) : projectDomain) + apiInfo); $.ajax({ method: method, url: requestUrl, crossDomain: true }).done(function(data) { if (isNotBlank(data)) { var documentInfo = ((typeof data === 'string') ? JSON.parse(data) : data); var copyright = documentInfo.copyright; if (isBlank(copyright)) { return; } var title = (isNotBlank(copyright.title) ? (copyright.title + ' - ') : '') + '前后端交互'; $title.html(title); $headerContent.html(title); $footer.html(copyrightTemplate(copyright)); var doc = documentInfo.document; if (isBlank(doc)) { return; } $urlInfo.html(urlRenderTemplate(doc)); $urlNavInfo.html(navRenderTemplate(doc)); $('.bs-docs-sidebar > .nav').css('max-height', 'calc(100vh - 51px - 15px - 15px)'); $('pre[class="src src-json"]').each(function() { var $html = escapeHtml($(this).html()); var html; if (isNotBlank($html)) { html = $html.replace(/(.*?)(\/\*.*?\*\/)/g, '$1<span class="comment">$2</span>'); var recursiveRegex = /(!!!RECURSIVE OBJECT!!!)/; if (recursiveRegex.test($html)) { html = html.replace(new RegExp(recursiveRegex, 'g'), '<span class="bold red">!!!递归实体!!!</span>'); } } else { html = '<span class="red">响应为空 或 无法解析返回类型</span>'; } $(this).html(addLine(html)); }); var hash = location.hash; if (isNotBlank(hash)) { var $anchor = $(hash); if ($anchor.length > 0) { var $li = $('a[href="' + hash + '"]').parents('li'); $li.addClass('active'); $li.parents('li').addClass('active'); $('html,body').animate({scrollTop: $anchor.offset().top}, 0); } } $('.form-datetime').datetimepicker({ ignoreReadonly: true, showTodayButton: true, showClear: true, showClose: true }); } else { $urlInfo.html('<span class="red">无接口信息</span>'); } }).fail(function(error) { console.error(method + ' ' + requestUrl + ' 错误: ' + JSON.stringify(error)); $urlInfo.html('<span class="red">接口无法请求, 网络有误 或 有跨域问题</span>'); }); } function addComment(json, element) { var fieldCommentRelation = handleFieldCommentRelation(element); if (isBlank(fieldCommentRelation)) { return json; } var lineFieldRelation = handleLineFieldRelation(json); if (isBlank(lineFieldRelation)) { return json; } var returnJson = ''; var i, lines = json.split('\n'); for (i = 0; i < lines.length; i++) { returnJson += lines[i]; var comment = getComment(lineFieldRelation, fieldCommentRelation, i.toString()); if (isNotBlank(comment)) { returnJson += ' '.repeat(2) + '<span class="comment">/* ' + comment + ' */</span>'; } returnJson += '\n'; } return returnJson.trim(); } function handleFieldCommentRelation(element) { var relation = relationByComment(element.find('[data-flag="module-api-info-return-comment"]')); return isNotBlank(relation) ? relation : relationBySource(element.find('[data-flag="module-api-info-return-src"]')); } function relationByComment(allComment) { if (isBlank(allComment.html())) { return null; } var $trs = allComment.find('table > tbody > tr'); if (hasExampleWithLevel($trs)) { return returnCommentWithParentLevel($trs); } else { return returnCommentWithLevel($trs); } } function hasExampleWithLevel(trsInTable) { var i; for (i = 0; i < trsInTable.length; i++) { var tds = $(trsInTable[i]).find('td'); if (tds.length > 2) { var name = $(tds[0]).text(); if (name.includes(' -> ')) { return true; } } } return false; } function returnCommentWithParentLevel($trs) { var paramCommentRelation = {}; var i; for (i = 0; i < $trs.length; i++) { var $tds = $($trs[i]).find('td'); if ($tds.length > 2) { var comment = $($tds[2]).text().trim(); if (isNotBlank(comment)) { var name = $($tds[0]).text().trim(); paramCommentRelation[name.split(' -> ').reverse().join('.')] = comment; } } } return paramCommentRelation; } function returnCommentWithLevel($trs) { var relation = {}; var tabLen = 4; var tmpArr = []; $trs.each(function() { var $tds = $(this).find('td'); if ($tds.length > 2) { var name = $($tds[0]).text(); var comment = $($tds[2]).text().trim(); var currentLevel = ((name.length - name.trimLeft().length) / tabLen) + 1; var parent = getParent(tmpArr, currentLevel); var currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim(); tmpArr.push({ level: currentLevel, name: currentName, value: comment }); } }); tmpArr.forEach(function(e) { if (isNotBlank(e.value)) { relation[e.name] = e.value; } }); return relation; } function getParent(arr, currentLevel) { if (arr.length === 0 || currentLevel === 1) { return null; } var i; for (i = arr.length; i > 0; i--) { var ele = arr[i - 1]; if (isNotBlank(ele) && ele.level === currentLevel - 1) { return ele; } } return null; } function relationBySource(sourceComment) { var comment = sourceComment.html(); if (isBlank(comment)) { return null; } var firstEnd = '</span>'; comment = comment.substring(comment.indexOf(firstEnd) + firstEnd.length); comment = comment.replace(/<span class=".*">|<\/span>/g, ''); var relation = {}; var tabLen = 2; var tmpArr = []; var i, lines = comment.split('\n'); for (i = 0; i < lines.length; i++) { var line = lines[i]; var lineTrim = line.trim(); if (/".*?" : .*?/.test(lineTrim)) { var name = lineTrim.substring(1, lineTrim.indexOf('" : ')); var start = ' /* ', end = ' */', strStart = '" : "', strEnd = '"'; var paramComment = / \/\* .*? \*\/$/.test(lineTrim) ? lineTrim.substring(lineTrim.lastIndexOf(start) + start.length, lineTrim.length - end.length) : (/^".*?" : ".*?"/.test(lineTrim) ? lineTrim.substring(lineTrim.indexOf(strStart) + strStart.length, lineTrim.lastIndexOf(strEnd)) : ''); var currentLevel = (line.length - line.trimLeft().length) / tabLen; var parent = getParent(tmpArr, currentLevel); var currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim(); tmpArr.push({ level: currentLevel, name: currentName, value: paramComment }); } } tmpArr.forEach(function(e) { if (isNotBlank(e.value)) { relation[e.name] = e.value; } }); return relation; } function handleLineFieldRelation(json) { if (isBlank(json)) { return null; } else { var relation = {}; var tabLen = 2; var tmpArr = []; var i, lines = json.split('\n'); for (i = 0; i < lines.length; i++) { var line = lines[i]; var lineTrim = line.trim(); if (/".*?": .*?/.test(lineTrim)) { var name = lineTrim.substring(1, lineTrim.indexOf('": ')); var currentLevel = (line.length - line.trimLeft().length) / tabLen; var parent = getSourceParent(tmpArr, currentLevel); var currentName = isNotBlank(parent) ? (parent.name + '.' + name.trim()) : name.trim(); tmpArr.push({ level: currentLevel, name: currentName, array: lineTrim.endsWith('": [') }); relation[i.toString()] = currentName; } } return relation; } } function getSourceParent(arr, currentLevel) { if (arr.length === 0 || currentLevel === 1) { return null; } var i; for (i = arr.length; i > 0; i--) { var ele = arr[i - 1]; if (isNotBlank(ele) && (ele.level === currentLevel - 1 || (ele.array === true && ele.level === currentLevel - 2))) { return ele; } } return null; } function getComment(lineFieldRelation, fieldCommentRelation, key) { var field = lineFieldRelation[key]; if (isBlank(field)) { return null; } var comment = fieldCommentRelation[field]; if (isNotBlank(comment)) { return comment; } var strAndIntKey = []; $.each(fieldCommentRelation, function(key) { var arr = key.split('.'); var strArr = []; for (var i = 0; i < arr.length; i++) { if (arr[i] === '?') { strArr.push(i + ',?'); } else if (arr[i] === '0') { strArr.push(i + ',0'); } } var str = strArr.join('-'); if (strAndIntKey.indexOf(str) === -1) { strAndIntKey.push(str); } }); var fieldArr = field.split('.'); var i; for (i = 0; i < strAndIntKey.length; i++) { var strAndInt = strAndIntKey[i]; var arr = fieldArr.slice(0); strAndInt.split('-').forEach(function(e) { var split = e.split(','); if (split.length === 2) { arr[split[0]] = split[1]; } }); comment = fieldCommentRelation[arr.join('.')]; if (isNotBlank(comment)) { return comment; } } return null; } $(function() { $(document.body).scrollspy({target: '.bs-docs-sidebar'}); $(document).on('change', '.project-choose', function() { var projectUrl = $(this).find('option:selected').data('url'); var hash = isBlank(projectUrl) ? '' : ('?p=' + $(this).val()); history.replaceState({api: $(this).val()}, '', location.pathname + hash); loadData(); }); $(document).on('change', '.form-file', function() { var $this = $(this); $this.parents('.input-group').find(':text').val($this.val()); }); $(document).on('change', '.has-token', function() { var $this = $(this); var name = $this.attr('name'); var value = $this.val(); localStorage.setItem(name, value); $('[name="' + name + '"]').val(value); }); $(document).on('click', '.form-submit', function() { var $btn = $(this); var $form = $btn.parents('form'); var $formParent = $form.parents('.module-api-info'); var curl = $form.find('.curl'); var response = $form.find('.response'); curl.hide(); response.hide(); $.validationEngine.defaults.scroll = false; var flag = $form.validationEngine('validate', { scroll: false }); if (!flag) { return; } var projectDomain = getProjectDomain(); var method = $form.attr('method'); var url = '/cn/' + $form.attr('data-test-url') + '.json'; var hasRequestBody = String($btn.attr('requestBody')) === '1'; var map = objectifyForm($form); var params = map[0]; var headers = map[1]; var files = map[2]; if (!url.toLowerCase().startsWith('http://') && !url.toLowerCase().startsWith('https://')) { if (!url.startsWith('/')) { url = '/' + url; } url = projectDomain + url; } var placeRegex = /{(.*?)}/; while (placeRegex.test(url)) { var group = RegExp.$1; var value = params[group]; url = url.replace(placeRegex, value); delete params[group]; } var tmpUrl = url; var line = ' \\\n'; var curlHtml = 'curl -i -X ' + method + line; curlHtml += "&nbsp; -A '" + navigator.userAgent + "'" + line; if (isNotBlank(document.cookie)) { curlHtml += "&nbsp; -b '" + document.cookie + "'" + line; } if (Object.getOwnPropertyNames(headers).length > 0) { $.each(headers, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -H '" + (key + ': ' + value) + "'" + line; } }); } if (hasRequestBody) { curlHtml += "&nbsp; -H 'Content-Type: application/json'" + line; curlHtml += "&nbsp; -H 'Accept: application/json'" + line; } if (files.length > 0) { if (Object.getOwnPropertyNames(params).length > 0) { $.each(params, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -F '" + (key + '=' + value) + "'" + line; } }); } $.each(files, function(i, file) { var fileName = file.name; var filePath = file.value; if (isNotBlank(fileName) && isNotBlank(filePath)) { filePath = filePath.replace('C:\\fakepath\\', '/$替换真实路径$/'); curlHtml += "&nbsp; -F '" + (fileName + '=@' + filePath) + "'" + line; } }); } else { if (Object.getOwnPropertyNames(params).length > 0) { if (hasRequestBody) { curlHtml += "&nbsp; -d '" + JSON.stringify(params) + "'" + line; } else { if ('GET' === method.toUpperCase()) { var paramArr = []; $.each(params, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { paramArr.push(key + '=' + value); } }); var paramStr = paramArr.join('&'); if (paramStr.length > 0) { tmpUrl += (url.includes('?') ? '&' : '?') + paramStr; } } else { $.each(params, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { curlHtml += "&nbsp; -d '" + (key + '=' + value) + "'" + line; } }); } } } } curlHtml += "&nbsp; --url '" + (tmpUrl.startsWith('//') ? (location.protocol + tmpUrl) : tmpUrl) + "'"; curlHtml = curlHtml.replace(/&nbsp;/g, ' '); if (curlHtml.length <= 100) { curlHtml = curlHtml.replace(new RegExp(line.replace('\\', '\\\\'), 'g'), ''); if (!curlHtml.includes('\\')) { curlHtml = curlHtml.replace(/\s{2,}/g, ' '); } } curl.find('pre').html(addLine(curlHtml)); curl.show(); var settings = { method: 'GET', url: url, beforeSend: function(request) { if (Object.getOwnPropertyNames(headers).length > 0) { $.each(headers, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { request.setRequestHeader(key, value); } }); } } }; var locationDomain = location.protocol + '//' + location.host; if (isNotBlank(projectDomain) && locationDomain !== projectDomain && !projectDomain.startsWith(locationDomain + '/')) { settings.crossDomain = true; settings.xhrFields = { withCredentials: true }; } if (files.length > 0) { if ('POST' !== method.toUpperCase()) { response.find('pre').html("<span class='red'>上传文件需要用 POST(用上面的 cURL 是可以的), 请联系后端修改!</span>"); response.show(); return; } var formData = new FormData(); $.each(params, function(key, value) { if (isNotBlank(key) && isNotBlank(value)) { formData.append(key, value); } }); $.each(files, function(i, f) { formData.append(f.name, f.files[0]); }); settings['data'] = formData; settings['cache'] = false; settings['processData'] = false; settings['contentType'] = false; } else { if (hasRequestBody) { if ('GET' === method.toUpperCase()) { response.find('pre').html("<span class='red'>浏览器不能通过 GET 请求发送 RequestBody 参数" + "(用上面的 cURL 是可以的), 请联系后端修改成 POST!</span>"); response.show(); return; } settings['contentType'] = 'application/json'; settings['dataType'] = 'json'; settings['data'] = JSON.stringify(params); } else { settings['data'] = params; } } var responseData = response.find('pre'); var start = new Date().getTime(); $btn.attr('disabled', 'disabled'); $btn.addClass('disabled'); $.ajax(settings).done(function(result) { var html = timeLog(start); if (isBlank(result)) { html += '<span class="green">' + method + ' 请求(' + url + ')成功, 但是响应为空</span>'; } else { html += addLine(addComment(escapeHtml(JSON.stringify(result, null, 2)), $formParent)); } responseData.attr('data-remove-comment', '1'); responseData.css('white-space', ''); responseData.html(html); response.show(); $btn.removeAttr('disabled'); $btn.removeClass('disabled'); }).fail(function(error) { var html = timeLog(start); if (isBlank(error)) { html += '<span class="red">' + method + ' 请求(' + url + ')失败</span>'; } else { html += '<span class="red">响应码: ' + error.status + '</span>'; var json = error.responseJSON; if (isNotBlank(json)) { html += '\n\n' + escapeHtml(JSON.stringify(json, null, 2)); } else { var text = error.responseText; if (isNotBlank(text)) { html += '\n<span class="red wrap">响应文本: ' + escapeHtml(text) + '</span>'; } else { html += '\n<span class="red">响应为空</span>'; } } } responseData.removeAttr('data-remove-comment'); responseData.css('white-space', 'pre-wrap'); responseData.html(html); response.show(); $btn.removeAttr('disabled'); $btn.removeClass('disabled'); }); }); $(document).on('click', '.copy', function() { var $this = $(this); var $pre = $this.next(); var copyValue = $pre.html(); var firstEnd = '</span>'; copyValue = copyValue.substring(copyValue.indexOf(firstEnd) + firstEnd.length); var removeComment = String($pre.attr('data-remove-comment')) === '1'; copyValue = copyValue.replace((removeComment ? /[ ]{2}<span class=".*?">.*?<\/span>/g : /<span class=".*?">|<\/span>/g), ''); var copyElement = document.createElement('textarea'); copyElement.setAttribute('readonly', 'readonly'); copyElement.setAttribute('class', 'copy-impl'); $(copyElement).html(copyValue); var $parent = $this.parent()[0]; $parent.appendChild(copyElement); copyElement.setSelectionRange(0, copyValue.length); copyElement.select(); var flag = document.execCommand('copy'); $parent.removeChild(copyElement); var $copyStatus = $this.prev(); $copyStatus.text('复制' + (flag ? '成功' : '失败')); setTimeout(function() { $copyStatus.text(''); }, 2000); }); $(window).scroll(function() { var headerHeight = 51; var topBottomHeight = 30; var scrolled = 'scrolled'; var heightProperty = 'max-height'; var html = document.getElementsByTagName('html')[0]; var footer = document.getElementsByTagName('footer')[0]; var $win = $(window); var $nav = $('.col-md-3'); var $bar = $('.bs-docs-sidebar > .nav'); var $header = $('header'); var scrollTop = $win.scrollTop(); if (scrollTop > 0) { if (!$header.hasClass(scrolled)) { $header.addClass(scrolled); } } else { $header.removeClass(scrolled); } if ($nav.css('display') !== 'none') { var footerTop = footer.offsetTop; var pageHeight = scrollTop + $win.height(); if (footerTop >= scrollTop && footerTop < pageHeight) { var footViewHeight = pageHeight - footerTop; $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight + footViewHeight) + 'px)'); } else { var htmlViewHeight = (html.clientHeight - headerHeight - topBottomHeight) + 'px'; if ($bar.css(heightProperty) !== htmlViewHeight) { $bar.css(heightProperty, 'calc(100vh - ' + (headerHeight + topBottomHeight) + 'px)'); } } var navHash = $nav.find('.active > a:last').attr('href'); if (navHash !== location.hash) { if (isBlank(navHash)) { if ($header.hasClass(scrolled) !== true) { history.replaceState({api: 'index'}, '', location.pathname + location.search); } } else { history.replaceState({api: navHash}, '', location.pathname + location.search + navHash); } } } }); }); </script> </body> </html>
